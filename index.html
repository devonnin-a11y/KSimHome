<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hearth & Home – Solopa Viking HUD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&family=Inter:wght@300;400;600&display=swap">
  <style>
    :root {
      --bg: #12090b;
      --bg-soft: #1b1011;
      --card: #241313;
      --card-soft: #2b1814;
      --border: #4a2b22;
      --accent: #fbbf24;
      --accent-soft: #f97316;
      --sage: #a3e635;
      --sage-soft: #bbf7d0;
      --text: #f9fafb;
      --muted: #d1d5db;
      --muted-soft: #9ca3af;
      --done: #22c55e;
      --bad: #f97373;
    }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #3b1d1d 0, #12090b 45%, #060308 100%);
      color: var(--text);
      min-height: 100vh;
    }

    /* SIMPLE MODE HIDES */
    body.simple-mode [data-simple-hide="true"] {
      display: none !important;
    }
    body.simple-mode .nav-btn[data-view="statsView"] {
      display: none !important;
    }

    .app {
      max-width: 1080px;
      margin: 0 auto;
      padding: 0.4rem 0.8rem 2rem;
    }

    /* NAV */

    .top-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.35rem;
      margin-top: 0.4rem;
      flex-wrap: wrap;
    }

    .nav-group {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
    }

    .nav-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(12, 6, 4, 0.9);
      color: var(--muted-soft);
      font-size: 0.7rem;
      padding: 0.22rem 0.85rem;
      cursor: pointer;
      transition: background 0.18s ease, border-color 0.18s ease, color 0.18s ease;
    }

    .nav-btn:hover {
      background: rgba(40, 24, 16, 0.9);
      color: #fef9c3;
    }

    .nav-btn.active {
      background: radial-gradient(circle at top left, #4b2619 0, #12090b 65%);
      border-color: var(--accent);
      color: #fef3c7;
      box-shadow: 0 0 12px rgba(251, 191, 36, 0.6);
    }

    header {
      text-align: center;
      margin-bottom: 0.6rem;
    }

    .title {
      font-family: "Uncial Antiqua", system-ui;
      font-size: 1.6rem;
      color: var(--accent);
      letter-spacing: 0.12em;
      text-transform: uppercase;
      text-shadow:
        0 0 18px rgba(251, 191, 36, 0.45),
        0 0 40px rgba(0, 0, 0, 0.9);
    }

    .subtitle {
      font-size: 0.82rem;
      color: var(--muted);
      margin-top: 0.2rem;
    }

    .subtitle span.em {
      color: var(--sage);
      font-weight: 600;
    }

    .today-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.18rem 0.75rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at top left, #4b2619 0, #1b1011 60%);
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 0.35rem;
    }

    .today-pill span.day-name {
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--accent);
      font-weight: 600;
    }

    .today-pill span.date-text {
      color: var(--muted);
    }

    .goddess-line {
      font-size: 0.7rem;
      color: var(--muted-soft);
      margin-top: 0.25rem;
    }

    .goddess-line span {
      color: var(--sage-soft);
      font-weight: 500;
    }

    /* MOODLETS */

    .moodlet-strip {
      margin: 0.55rem auto 0.3rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      justify-content: center;
    }

    .moodlet {
      min-width: 120px;
      max-width: 190px;
      padding: 0.25rem 0.5rem;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(12, 8, 7, 0.95);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.75);
      font-size: 0.7rem;
      position: relative;
    }

    .moodlet-positive {
      border-color: rgba(190, 242, 100, 0.9);
      box-shadow: 0 0 18px rgba(190, 242, 100, 0.3);
    }

    .moodlet-negative {
      border-color: rgba(248, 113, 113, 0.9);
      box-shadow: 0 0 18px rgba(248, 113, 113, 0.3);
    }

    .moodlet-neutral {
      border-color: rgba(251, 191, 36, 0.8);
      box-shadow: 0 0 16px rgba(251, 191, 36, 0.25);
    }

    .moodlet-title-row {
      display: flex;
      justify-content: space-between;
      gap: 0.4rem;
      align-items: center;
      margin-bottom: 0.12rem;
    }

    .moodlet-name {
      font-size: 0.72rem;
      font-weight: 600;
    }

    .moodlet-pips {
      font-size: 0.7rem;
    }

    .moodlet-desc {
      font-size: 0.68rem;
      color: var(--muted-soft);
    }

    .moodlet-timer {
      font-size: 0.63rem;
      color: var(--muted-soft);
      margin-top: 0.08rem;
      text-align: right;
    }

    .current-mood-label {
      font-size: 0.72rem;
      color: var(--muted-soft);
      text-align: center;
      margin-top: 0.15rem;
    }

    .current-mood-label span {
      color: #fef3c7;
      font-weight: 600;
    }

    /* GRID */

    .grid-main {
      display: grid;
      grid-template-columns: 1.2fr 1.1fr;
      gap: 0.8rem;
      margin-top: 0.5rem;
    }

    @media (max-width: 820px) {
      .grid-main {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: radial-gradient(circle at top left, #432117 0, #241313 55%, #1b1011 100%);
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 0.8rem 0.9rem;
      box-shadow:
        0 14px 35px rgba(0, 0, 0, 0.8),
        inset 0 0 0 1px rgba(0, 0, 0, 0.4);
    }

    .card-soft {
      background: radial-gradient(circle at top left, #3a221b 0, #1b1011 70%);
    }

    .section-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.4rem;
      flex-wrap: wrap;
    }

    .section-title {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .section-sub {
      font-size: 0.72rem;
      color: var(--muted-soft);
    }

    .tag {
      font-size: 0.65rem;
      padding: 0.12rem 0.55rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--muted);
      white-space: nowrap;
    }

    .tag-soft {
      border-color: var(--sage);
      color: var(--sage-soft);
    }

    .tag-fire {
      border-color: var(--accent-soft);
      color: var(--accent-soft);
    }

    /* DAILY RHYTHM */

    .timeline {
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
      margin-top: 0.15rem;
    }

    .block {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 0.35rem 0.5rem;
      padding: 0.35rem 0.4rem;
      border-radius: 12px;
      background: rgba(15, 9, 8, 0.7);
      border: 1px solid rgba(75, 85, 99, 0.3);
    }

    .block-time {
      font-size: 0.7rem;
      color: var(--muted-soft);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding-top: 0.1rem;
    }

    .block-main {
      font-size: 0.8rem;
    }

    .block-main-title {
      font-weight: 600;
      color: var(--accent-soft);
      margin-bottom: 0.12rem;
    }

    .block-main-items {
      list-style: none;
      margin: 0;
      padding-left: 0;
      font-size: 0.74rem;
      color: var(--muted);
    }

    .block-main-items li {
      margin-bottom: 0.08rem;
    }

    .block-main-items li span.self {
      color: var(--sage-soft);
      font-weight: 500;
    }

    .block-main-items li span.kids {
      color: #fecaca;
      font-weight: 500;
    }

    /* TODAY TASKS */

    .today-day-tag {
      font-size: 0.72rem;
      color: var(--muted-soft);
      margin-bottom: 0.15rem;
    }

    .task-list {
      list-style: none;
      margin: 0.2rem 0 0;
      padding: 0;
    }

    .task {
      display: flex;
      align-items: flex-start;
      gap: 0.45rem;
      padding: 0.26rem 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.7);
      font-size: 0.82rem;
    }

    .task:last-child {
      border-bottom: none;
    }

    .task input[type="checkbox"] {
      margin-top: 0.1rem;
      width: 16px;
      height: 16px;
      border-radius: 5px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      accent-color: var(--done);
      background: #0b0b0b;
      flex-shrink: 0;
    }

    .task-area {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--muted-soft);
    }

    .task-main {
      font-weight: 500;
      color: var(--text);
    }

    .task-desc {
      font-size: 0.72rem;
      color: var(--muted-soft);
      margin-top: 0.08rem;
    }

    .self-note {
      font-size: 0.7rem;
      color: var(--muted-soft);
      margin-top: 0.5rem;
    }

    .self-note span {
      color: var(--sage);
      font-weight: 500;
    }

    .bad-day-row {
      margin-top: 0.55rem;
      font-size: 0.72rem;
    }

    .bad-day-btn {
      width: 100%;
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: transparent;
      color: var(--muted-soft);
      padding: 0.4rem 0.6rem;
      cursor: pointer;
      font-size: 0.72rem;
      text-align: center;
      transition: background 0.18s ease, border-color 0.18s ease, color 0.18s ease;
    }

    .bad-day-btn:hover {
      background: rgba(24, 16, 12, 0.9);
      border-color: rgba(251, 191, 36, 0.6);
      color: #fef9c3;
    }

    .bad-day-btn.active {
      background: radial-gradient(circle at top left, #4b2619 0, #12090b 65%);
      border-color: var(--accent);
      color: #fef3c7;
      box-shadow: 0 0 14px rgba(251, 191, 36, 0.6);
    }

    .bad-day-msg {
      margin-top: 0.25rem;
      font-size: 0.7rem;
      color: var(--sage-soft);
    }

    .self-reward {
      margin-top: 0.45rem;
      padding: 0.45rem 0.5rem;
      border-radius: 12px;
      background: radial-gradient(circle at top left, #3b2319 0, #12090b 70%);
      border: 1px dashed rgba(254, 215, 170, 0.5);
      font-size: 0.72rem;
    }

    .self-reward-title {
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 0.7rem;
      color: var(--accent-soft);
      margin-bottom: 0.2rem;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
    }

    .chip {
      font-size: 0.7rem;
      padding: 0.12rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(12, 10, 9, 0.9);
      color: #fef9c3;
    }

    .chip-soft {
      border-color: rgba(190, 242, 100, 0.8);
      color: var(--sage-soft);
    }

    .chip-cozy {
      border-color: rgba(251, 191, 36, 0.7);
      color: #fed7aa;
    }

    .self-bonus-btn {
      margin-top: 0.45rem;
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(190, 242, 100, 0.8);
      background: rgba(12, 18, 8, 0.9);
      color: var(--sage-soft);
      padding: 0.32rem 0.6rem;
      font-size: 0.72rem;
      cursor: pointer;
    }

    .self-bonus-btn:hover {
      background: rgba(27, 46, 18, 0.95);
    }

    /* SELF-CARE & FEELINGS */

    .selfcare-groups {
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
      margin-top: 0.25rem;
    }

    .sc-group {
      padding: 0.4rem 0.45rem;
      border-radius: 12px;
      background: rgba(12, 8, 7, 0.7);
      border: 1px solid rgba(75, 85, 99, 0.4);
      font-size: 0.74rem;
    }

    .sc-title {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #fed7aa;
      margin-bottom: 0.15rem;
    }

    .sc-list {
      list-style: none;
      margin: 0;
      padding-left: 1rem;
      color: var(--muted);
    }

    .sc-list li {
      margin-bottom: 0.08rem;
    }

    .sc-list li span.strong {
      color: var(--sage-soft);
      font-weight: 500;
    }

    .sc-hint {
      font-size: 0.68rem;
      color: var(--muted-soft);
      margin-top: 0.3rem;
    }

    .sc-hint span {
      color: var(--accent);
    }

    .feelings-section {
      margin-top: 0.7rem;
      padding-top: 0.55rem;
      border-top: 1px solid rgba(75, 85, 99, 0.7);
    }

    .feelings-title {
      font-size: 0.78rem;
      font-weight: 500;
      color: #fee2b3;
      margin-bottom: 0.25rem;
    }

    .feelings-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-bottom: 0.35rem;
    }

    .feeling-btn {
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.8);
      background: rgba(10, 6, 4, 0.9);
      color: var(--muted-soft);
      padding: 0.2rem 0.65rem;
      font-size: 0.7rem;
      cursor: pointer;
      transition: background 0.18s ease, border-color 0.18s ease, color 0.18s ease;
    }

    .feeling-btn:hover {
      background: rgba(40, 24, 16, 0.9);
      border-color: rgba(251, 191, 36, 0.7);
      color: #fef9c3;
    }

    .feelings-msg {
      font-size: 0.7rem;
      color: var(--sage-soft);
      min-height: 1.2em;
    }

    /* CALENDAR & JOURNALS */

    .calendar-wrapper {
      margin-top: 0.7rem;
      padding-top: 0.6rem;
      border-top: 1px solid rgba(75, 85, 99, 0.7);
    }

    .calendar-header-title {
      font-size: 0.8rem;
      font-weight: 500;
      color: #fee2b3;
      margin-bottom: 0.25rem;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.25rem;
      margin-top: 0.15rem;
      font-size: 0.72rem;
    }

    .cal-header {
      text-align: center;
      font-size: 0.68rem;
      color: var(--muted-soft);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-top: 0.1rem;
    }

    .day-cell {
      padding: 0.25rem 0.12rem 0.32rem;
      border-radius: 9px;
      border: 1px solid rgba(75, 85, 99, 0.7);
      background: rgba(10, 6, 5, 0.9);
      text-align: center;
      cursor: pointer;
      position: relative;
    }

    .day-cell.today {
      border-color: var(--accent);
      box-shadow:
        0 0 0 1px rgba(251, 191, 36, 0.4),
        0 0 16px rgba(0, 0, 0, 0.9);
    }

    .day-cell-number {
      font-size: 0.76rem;
      font-weight: 500;
      color: #fef3c7;
    }

    .day-cell-info {
      margin-top: 0.08rem;
      font-size: 0.63rem;
      color: var(--muted-soft);
    }

    .day-cell-complete {
      position: absolute;
      top: 3px;
      right: 4px;
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: var(--done);
      box-shadow: 0 0 6px rgba(34, 197, 94, 0.8);
    }

    .stats-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-top: 0.45rem;
      font-size: 0.7rem;
      color: var(--muted-soft);
    }

    .stat-pill {
      padding: 0.12rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.7);
      background: rgba(10, 6, 4, 0.9);
    }

    .stat-pill strong {
      color: var(--accent-soft);
    }

    .month-notes-label,
    .daily-journal-label,
    .year-journal-label {
      font-size: 0.72rem;
      color: var(--muted-soft);
      margin-top: 0.6rem;
      margin-bottom: 0.18rem;
    }

    textarea {
      width: 100%;
      min-height: 70px;
      border-radius: 12px;
      border: 1px solid rgba(75, 85, 99, 0.8);
      background: rgba(7, 5, 6, 0.9);
      color: var(--text);
      font-size: 0.78rem;
      padding: 0.5rem;
      resize: vertical;
    }

    textarea:focus {
      outline: 1px solid rgba(251, 191, 36, 0.7);
    }

    .hint {
      font-size: 0.68rem;
      color: var(--muted-soft);
      margin-top: 0.35rem;
    }

    .hint span {
      color: var(--sage-soft);
    }

    /* STATS VIEW */

    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 0.8rem;
      margin-top: 0.7rem;
    }

    @media (max-width: 820px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    .stat-card-title {
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
      color: #fee2b3;
    }

    .stat-number {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--accent-soft);
    }

    .stat-label {
      font-size: 0.7rem;
      color: var(--muted-soft);
      margin-bottom: 0.15rem;
    }

    .need-card {
      margin-top: 0.4rem;
      padding: 0.35rem 0.45rem;
      border-radius: 12px;
      background: rgba(12, 8, 7, 0.7);
      border: 1px solid rgba(75, 85, 99, 0.6);
      font-size: 0.74rem;
    }

    .need-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.05rem;
      flex-wrap: wrap;
    }

    .need-name {
      font-size: 0.78rem;
      font-weight: 500;
      color: #fee2b3;
    }

    .need-status {
      font-size: 0.68rem;
      color: var(--muted-soft);
    }

    .need-status.overdue {
      color: #fecaca;
    }

    .need-next {
      font-size: 0.68rem;
      color: var(--muted-soft);
      margin-bottom: 0.22rem;
    }

    .need-btns {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
    }

    .need-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(10, 6, 5, 0.9);
      color: var(--muted-soft);
      padding: 0.16rem 0.55rem;
      font-size: 0.68rem;
      cursor: pointer;
    }

    .need-btn.ok {
      border-color: rgba(34, 197, 94, 0.9);
      color: #bbf7d0;
    }

    .need-btn.skip {
      border-color: rgba(248, 113, 113, 0.9);
      color: #fecaca;
    }

    .need-btn:hover {
      background: rgba(35, 24, 18, 0.95);
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="top-nav">
      <div class="nav-group">
        <button class="nav-btn active" data-view="homeView">Rhythm & Quests</button>
        <button class="nav-btn" data-view="statsView">Stats & Needs</button>
      </div>
      <div class="nav-group">
        <button class="nav-btn" id="simpleToggleBtn">Simple View: Off</button>
        <button class="nav-btn" id="saveBtn">Save Backup</button>
      </div>
    </div>

    <header>
      <div class="title">Hearth & Home</div>
      <div class="subtitle">
        Your life, like a cozy Sims game: just <span class="em">two quests</span> + needs + self-care buffs.
      </div>
      <div class="today-pill" id="todayLabel">
        <span class="day-name">TODAY</span>
        <span class="date-text"></span>
      </div>
      <div class="goddess-line">
        You are not “just a mom.” You are the <span>hearth-keeper</span> of this tiny homestead.
      </div>

      <div class="moodlet-strip" id="moodletStrip"></div>
      <div class="current-mood-label" id="currentMoodLabel">
        Current mood: <span>loading…</span>
      </div>
    </header>

    <!-- HOME VIEW -->
    <div id="homeView" class="view active">
      <div class="grid-main">
        <!-- LEFT: rhythm + quests -->
        <div class="card card-soft">
          <div class="section-title-row" data-simple-hide="true">
            <div>
              <div class="section-title">Daily Rhythm</div>
              <div class="section-sub">
                Soft structure around what already happens. Times are flexible, not strict.
              </div>
            </div>
            <span class="tag tag-fire">Kids • Home • You</span>
          </div>

          <div class="timeline" data-simple-hide="true">
            <div class="block">
              <div class="block-time">4:00–8:00</div>
              <div class="block-main">
                <div class="block-main-title">Early Dawn – Cozy Wake & Check-in</div>
                <ul class="block-main-items">
                  <li><span class="kids">Kids:</span> show time while everyone wakes slowly.</li>
                  <li><span class="self">You:</span> vlogs / quiet screen time, simple breakfast or drink.</li>
                  <li><span class="self">Together:</span> wake husband, short call, then breathe.</li>
                </ul>
              </div>
            </div>

            <div class="block">
              <div class="block-time">8:00–9:00</div>
              <div class="block-main">
                <div class="block-main-title">Slow Morning Scroll + Tiny Reset</div>
                <ul class="block-main-items">
                  <li><span class="self">You:</span> Pinterest / phone time is okay.</li>
                  <li><span class="self">Tiny win:</span> wash face, brush teeth, hair up or oil in hair.</li>
                  <li><span class="kids">Kids:</span> light play / shows nearby.</li>
                </ul>
              </div>
            </div>

            <div class="block">
              <div class="block-time">9:00–11:00</div>
              <div class="block-main">
                <div class="block-main-title">Homeschool Focus Block</div>
                <ul class="block-main-items">
                  <li><span class="kids">Kids:</span> lessons, learning, or structured play.</li>
                  <li><span class="self">You:</span> you’ve done enough when they’ve engaged, not when it’s perfect.</li>
                </ul>
              </div>
            </div>

            <div class="block">
              <div class="block-time">11:00–1:00</div>
              <div class="block-main">
                <div class="block-main-title">Lunch + Quick Home Reset</div>
                <ul class="block-main-items">
                  <li><span class="kids">Kids:</span> eat, educational playlist / show.</li>
                  <li><span class="self">House:</span> choose 1 quick reset: sink, counters, or living room tidy.</li>
                </ul>
              </div>
            </div>

            <div class="block">
              <div class="block-time">1:00–3:00</div>
              <div class="block-main">
                <div class="block-main-title">Nap Attempt / Quiet Block</div>
                <ul class="block-main-items">
                  <li><span class="kids">Kids:</span> nap attempt or quiet activities if they won’t sleep.</li>
                  <li><span class="self">You:</span> shower OR skincare OR YouTube guilt-free while baby nurses.</li>
                </ul>
              </div>
            </div>

            <div class="block">
              <div class="block-time">3:00–5:00</div>
              <div class="block-main">
                <div class="block-main-title">Afternoon – Prep & Gentle Reset</div>
                <ul class="block-main-items">
                  <li><span class="self">House:</span> start dinner prep, quick dish load if possible.</li>
                  <li><span class="self">You:</span> water, snack, and choose one small task instead of “everything.”</li>
                </ul>
              </div>
            </div>

            <div class="block">
              <div class="block-time">5:00–9:00</div>
              <div class="block-main">
                <div class="block-main-title">Evening – Partner Home & Close</div>
                <ul class="block-main-items">
                  <li><span class="kids">Family:</span> dinner, laundry attempt, basic reset together.</li>
                  <li><span class="self">You:</span> choose: hot shower / drawing / just sitting. All are valid.</li>
                </ul>
              </div>
            </div>

            <div class="block">
              <div class="block-time">9:00–10:00</div>
              <div class="block-main">
                <div class="block-main-title">Night – Gentle Close of the Day</div>
                <ul class="block-main-items">
                  <li><span class="kids">Kids:</span> bedtime attempt, even if it runs late.</li>
                  <li><span class="self">You:</span> one show, skincare, or read 2–3 pages. That counts.</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Today tasks -->
          <div style="margin-top:0.8rem;">
            <div class="section-title-row">
              <div>
                <div class="section-title">Today’s 2 House Quests</div>
                <div class="section-sub">
                  Two focused tasks only. The rest of the mess is just life happening.
                </div>
              </div>
              <span class="tag tag-soft" id="todayDayName"></span>
            </div>
            <div class="today-day-tag" id="todayDaySummary"></div>
            <ul class="task-list" id="todayTasks"></ul>

            <div class="self-note">
              When these two are done, the house part of today is a <span>complete win</span>.
              Everything else is bonus or can wait.
            </div>

            <div class="bad-day-row">
              <button type="button" class="bad-day-btn" id="badDayBtn">
                Bad day? Tap here to still count this day as a win
              </button>
              <div class="bad-day-msg" id="badDayMsg"></div>
            </div>

            <div class="self-reward">
              <div class="self-reward-title">After your two tasks…</div>
              <div class="chips">
                <span class="chip chip-cozy">Hot shower with no rush for a few minutes</span>
                <span class="chip chip-soft">Nighttime skincare (even just cleanser + moisturizer)</span>
                <span class="chip">Draw a tiny doodle or read 2–3 pages</span>
                <span class="chip">Scroll Pinterest guilt-free for 10–15 min</span>
              </div>
              <button type="button" class="self-bonus-btn" id="selfBonusBtn">
                I did some extra self-care or something just for me
              </button>
            </div>

            <div class="hint">
              Tip: if today blows up, it’s okay to move a task to tomorrow. The point is <span>kind rhythm</span>, not perfection.
            </div>
          </div>
        </div>

        <!-- RIGHT: self-care, feelings, calendar -->
        <div class="card">
          <div class="section-title-row" data-simple-hide="true">
            <div>
              <div class="section-title">Goddess Self-Care Menu</div>
              <div class="section-sub">
                Pick what fits your energy and the kids. Tiny versions still count.
              </div>
            </div>
            <span class="tag">Tiny is enough</span>
          </div>

          <div class="selfcare-groups" data-simple-hide="true">
            <div class="sc-group">
              <div class="sc-title">With kids awake</div>
              <ul class="sc-list">
                <li><span class="strong">5-minute skincare:</span> wash face, moisturizer, maybe oil. Kids can be in the room.</li>
                <li><span class="strong">Hair care touch:</span> oil scalp, braid, or quick bun that makes you feel put together.</li>
                <li><span class="strong">Quiet together:</span> sit on the floor near them and just breathe while they watch a show.</li>
              </ul>
            </div>

            <div class="sc-group">
              <div class="sc-title">During nap or “quiet attempt”</div>
              <ul class="sc-list">
                <li><span class="strong">Hot shower:</span> even 5–10 minutes is a full reset.</li>
                <li><span class="strong">Drawing moment:</span> one small doodle in a notebook.</li>
                <li><span class="strong">Reading:</span> 2–5 pages of a book, not a full chapter.</li>
                <li><span class="strong">YouTube guilt-free:</span> watch something for you while baby nurses.</li>
              </ul>
            </div>

            <div class="sc-group">
              <div class="sc-title">Evening / night</div>
              <ul class="sc-list">
                <li><span class="strong">Shower ritual:</span> warm water + favorite soap = day officially over.</li>
                <li><span class="strong">Skincare + hair wrap:</span> tell yourself “today was enough” in the mirror.</li>
                <li><span class="strong">Cozy plan time:</span> Pinterest homestead / balcony plant ideas for later.</li>
                <li><span class="strong">Baking as creative outlet:</span> when you have energy, once in a while, not every day.</li>
              </ul>
            </div>
          </div>

          <div class="sc-hint" data-simple-hide="true">
            You don’t have to earn rest by “finishing everything.” One tiny moment is enough to keep <span>you</span> alive inside the routine.
          </div>

          <!-- Feelings -->
          <div class="feelings-section">
            <div class="feelings-title">How are you feeling right now?</div>
            <div class="feelings-buttons">
              <!-- negative / heavy -->
              <button type="button" class="feeling-btn" data-feeling="stressed">Feeling Stressed</button>
              <button type="button" class="feeling-btn" data-feeling="overwhelmed">Feeling Overwhelmed</button>
              <button type="button" class="feeling-btn" data-feeling="depressed">Feeling Low</button>
              <button type="button" class="feeling-btn" data-feeling="sad">Feeling Sad</button>
              <button type="button" class="feeling-btn" data-feeling="angry">Feeling Angry</button>
              <button type="button" class="feeling-btn" data-feeling="hungry">Feeling Hungry</button>
              <!-- positive -->
              <button type="button" class="feeling-btn" data-feeling="good">Feeling Good</button>
              <button type="button" class="feeling-btn" data-feeling="happy">Feeling Happy</button>
              <button type="button" class="feeling-btn" data-feeling="peace">Feeling at Peace</button>
              <button type="button" class="feeling-btn" data-feeling="ease">Feeling at Ease</button>
            </div>
            <div class="feelings-msg" id="feelingsMsg"></div>
          </div>

          <!-- Calendar & Journals -->
          <div class="calendar-wrapper" data-simple-hide="true">
            <div class="calendar-header-title" id="monthLabel">This Month</div>
            <div class="calendar" id="calendarHeader"></div>
            <div class="calendar" id="calendarGrid"></div>

            <div class="stats-row" id="statsRow"></div>

            <div class="month-notes-label">Notes for this month</div>
            <textarea id="monthNotes" placeholder="What worked? What felt too much? What tiny changes do you want next month?"></textarea>

            <div class="daily-journal-label" id="dailyJournalLabel">Today’s journal</div>
            <textarea id="dailyJournal" placeholder="Write a couple of lines about today. Wins, hard parts, anything."></textarea>

            <div class="year-journal-label" id="yearJournalLabel">Year journal</div>
            <textarea id="yearJournal" placeholder="Bigger thoughts, goals, memories from this year."></textarea>

            <div class="hint">
              Everything here saves on this device only. If most days you use your phone, open it there and let this be your <span>little Sims HUD</span>.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- STATS VIEW -->
    <div id="statsView" class="view">
      <div class="card" data-simple-hide="true">
        <div class="section-title-row">
          <div>
            <div class="section-title">Stats & Level-Up</div>
            <div class="section-sub">
              See your long-term progress like a real-world Sim leveling up her Solopa Viking life.
            </div>
          </div>
          <span class="tag tag-soft" id="simLevelTag">Level 1 • Solopa Seedling of the North</span>
        </div>

        <div class="stats-grid">
          <div>
            <div class="stat-card-title">Lifetime Progress</div>
            <div class="stat-label">Total house quests counted</div>
            <div class="stat-number" id="statTotalQuests">0</div>

            <div class="stat-label" style="margin-top:0.3rem;">Days counted as a win (tasks or bad day)</div>
            <div class="stat-number" id="statWinDays">0</div>

            <div class="stat-label" style="margin-top:0.3rem;">Self-care bonuses logged</div>
            <div class="stat-number" id="statSelfCare">0</div>

            <div class="stat-label" style="margin-top:0.3rem;">Feelings check-ins</div>
            <div class="stat-number" id="statFeelings">0</div>
          </div>

          <div>
            <div class="stat-card-title">Needs (Sims-style)</div>
            <div class="stat-label">Tap “Did it” when you meet a need. These update moodlets & stats.</div>

            <div id="needsContainer"></div>
          </div>
        </div>

        <div class="hint" style="margin-top:0.7rem;">
          Needs reminders use your browser’s timers, so they only work while this page is open. 
          Voice cues and glowing cards act as your “alarm.”
        </div>
      </div>
    </div>
  </div>

  <script>
    /*************** CONFIG ***************/
    const STORAGE_PREFIX = "HearthHomeTwoTask_";

    const MASTER_TASKS = [
      { id: 1,  area: "Kitchen",   title: "Wipe kitchen counters & stove", desc: "Clear and wipe counters and stovetop so cooking feels calmer." },
      { id: 2,  area: "Kitchen",   title: "Sink & faucet scrub",           desc: "Scrub sink, faucet, and around the drain until it feels fresh." },
      { id: 3,  area: "Kitchen",   title: "Fridge handles & doors",        desc: "Wipe handles and front of the fridge (the “touch spots”)." },
      { id: 4,  area: "Kitchen",   title: "Quick pantry front tidy",       desc: "Straighten front shelves where you grab snacks / kid things." },
      { id: 5,  area: "Kitchen",   title: "Sweep or vacuum kitchen floor", desc: "Focus on crumbs under the table and in high-traffic spots." },

      { id: 6,  area: "Living Room", title: "Couch & blanket reset",       desc: "Fluff cushions, fold blankets, clear off couch surfaces." },
      { id: 7,  area: "Living Room", title: "Toy basket reset",            desc: "Toys into bins/baskets so the floor mostly appears again." },
      { id: 8,  area: "Living Room", title: "Living room surfaces",        desc: "Wipe coffee table, TV stand, or any cluttered flat surface." },
      { id: 9,  area: "Living Room", title: "Vacuum living room",          desc: "Just main paths and under the table/couch if possible." },

      { id: 10, area: "Bathrooms",  title: "Main bathroom wipe",          desc: "Sink, faucet, counter, quick mirror wipe, toilet seat once-over." },
      { id: 11, area: "Bathrooms",  title: "Toilet deep clean",           desc: "Inside bowl, seat, outside, and floor around the base." },
      { id: 12, area: "Bathrooms",  title: "Tub/shower quick scrub",      desc: "Quick scrub on walls and tub floor where soap builds up." },
      { id: 13, area: "Bathrooms",  title: "Bathroom floor & trash",      desc: "Sweep / spot mop and empty small trash cans." },

      { id: 14, area: "Bedrooms",   title: "Master bedroom surfaces",     desc: "Clear and wipe your nightstand + one other surface." },
      { id: 15, area: "Bedrooms",   title: "Kids bedroom tidy",           desc: "Pick one kid’s room: floor mostly clear, toys to their homes." },
      { id: 16, area: "Bedrooms",   title: "Change one bed",              desc: "Fresh sheets on one bed only. The others can wait." },
      { id: 17, area: "Bedrooms",   title: "Clothing mini-purge",         desc: "Pull 3–5 worn or outgrown items to donate or toss." },

      { id: 18, area: "Floors",     title: "Entry & hallway sweep",       desc: "Entry, hallway, and main walkway crumb-free if possible." },
      { id: 19, area: "Floors",     title: "Spot mop sticky spots",       desc: "Just the worst sticky/dirty floor patches (not the whole house)." },

      { id: 20, area: "Laundry",    title: "Fold & put away one load",    desc: "One basket from basket to drawers/closet. All the way done." },
      { id: 21, area: "Laundry",    title: "Laundry corner tidy",         desc: "Clear tops of machines, gather stray clothes, quick wipe." },

      { id: 22, area: "Entry",      title: "Shoe & coat reset",           desc: "Line up shoes and hang coats so leaving the house feels easier." },
      { id: 23, area: "Entry",      title: "Bag refresh",                 desc: "Empty trash, restock diapers/snacks in the go-bag." },

      { id: 24, area: "Dining",     title: "Dining table clear & wipe",   desc: "Clear clutter and wipe the full table surface." },
      { id: 25, area: "Dining",     title: "Chairs / highchair wipe",     desc: "Seat, arms, and tray where kids eat the most." },

      { id: 26, area: "Dusting",    title: "Dust one zone",               desc: "Pick one area (TV, shelves, window sills) and dust just that." },
      { id: 27, area: "Dusting",    title: "Doors & switches",            desc: "Wipe door handles and main light switches in key rooms." },

      { id: 28, area: "Deep-ish",   title: "One drawer or shelf",         desc: "Declutter/clean just one drawer or shelf that bugs you." },
      { id: 29, area: "Deep-ish",   title: "Appliance fronts",            desc: "Wipe outside of dishwasher, oven, and fridge doors." },

      { id: 30, area: "Bonus",      title: "Pick any “bother spot”",      desc: "Choose one little thing that’s been bugging you and clear it." }
    ];

    const CHAOS_AFFIRMATIONS = [
      "Today was heavy, but you still showed up for your kids. That is not nothing—that is everything.",
      "Some days the victory is simply that everyone is fed and safe. That absolutely counts.",
      "You are allowed to have bad days and still be a good mom, a good partner, and a good you.",
      "The house will wait. Your heart and your body are more important than the dishes.",
      "You are not behind. You are moving through a hard season doing your best in every direction."
    ];

    const FEELING_TEXTS = {
      stressed: [
        "Your body is telling you it’s carrying a lot. Take one slow breath in, one slow breath out. You don’t have to fix everything right now.",
        "You’re juggling so much. It’s okay to pause for a minute, drink water, and do just the next tiny thing.",
        "You’re allowed to lower the bar today. Two small wins are enough when your nervous system is tired."
      ],
      overwhelmed: [
        "When everything feels like too much, shrink your world to one small step: feed someone, hug someone, or sit down for a moment.",
        "You don’t have to carry the whole house, the whole day, and everyone’s emotions all at once. One thing at a time is enough.",
        "If today feels like too much, that doesn’t mean you’re failing. It means you are human in a very full season."
      ],
      depressed: [
        "Feeling low doesn’t mean you’re weak. It means you’ve been strong for a very long time. You deserve gentleness too.",
        "If getting through the day feels hard, surviving it is a real accomplishment. Please consider telling someone you trust how you feel.",
        "You’re not alone, and these feelings are not your fault. If they stay heavy, it’s okay to reach out for help from a professional or someone you trust."
      ],
      sad: [
        "It’s okay to be sad and still be an amazing mom. Your feelings are allowed to exist here.",
        "Tears and quiet days are part of being human. You don’t have to pretend you’re okay for this to still be a good life.",
        "If you feel like crying, that’s your heart letting some of the weight out. It’s okay."
      ],
      angry: [
        "Anger is a signal that something feels unfair or too much—it doesn’t make you a bad person.",
        "If you can, put the day on pause for 30 seconds: unclench your jaw, drop your shoulders, and breathe out the frustration.",
        "You’re allowed to step away for a minute, even if it’s just to the bathroom, to come back calmer."
      ],
      hungry: [
        "Feed yourself too. You matter just as much as the kids.",
        "It’s okay to grab something simple. You don’t have to cook a perfect meal to deserve food.",
        "Your body needs fuel, not just coffee and stress. A quick snack is a real act of self-care."
      ],
      good: [
        "Feeling good is worth noticing. Let yourself enjoy this softness in your day.",
        "You’re allowed to feel okay, even if everything isn’t perfect around you.",
        "Savor this moment of ‘good’—it’s proof that your efforts are paying off."
      ],
      happy: [
        "Happiness is a real resource. Let it refill you a little.",
        "Notice what’s making you happy and tuck it away as a tiny memory.",
        "You deserve these happy moments. You didn’t accidentally stumble into them—you helped create them."
      ],
      peace: [
        "Peace isn’t loud, but it’s powerful. Let your body rest here for a bit.",
        "This peaceful moment is medicine. You can carry it with you into the next chaos wave.",
        "You’ve carved out a pocket of peace inside a full life. That’s a skill, not an accident."
      ],
      ease: [
        "Feeling at ease means your nervous system finally gets to exhale.",
        "Let your shoulders drop and let yourself fully enjoy this ease.",
        "You don’t have to brace for the next thing right now. Let this ease soak in."
      ]
    };

    // Needs in minutes
    const NEEDS_CONFIG = {
      hydrate: {
        name: "Hydration",
        key: "need_hydrate",
        label: "Drink water",
        intervalMin: 90,
        reminderVoice: "Shield-maiden, it’s time to drink water and refill your cup.",
        overdueVoice: "Even a warrior of the North needs water. Take a sip if you can.",
        positiveMood: { name: "Hydrated", desc: "You drank water. Your body thanks you.", type: "positive" },
        negativeMood: { name: "Parched", desc: "You’ve gone a while without water. Be gentle with yourself.", type: "negative" }
      },
      eat: {
        name: "Meal",
        key: "need_eat",
        label: "Meal / real food",
        intervalMin: 4 * 60,
        reminderVoice: "It might be time for a real meal, not just bites off tiny plates.",
        overdueVoice: "Your warrior’s body needs food, not only coffee and crumbs.",
        positiveMood: { name: "Fed", desc: "You ate something real. Energy slowly returning.", type: "positive" },
        negativeMood: { name: "Running on empty", desc: "You’ve been pushing without real food.", type: "negative" }
      },
      snack: {
        name: "Snack",
        key: "need_snack",
        label: "Small snack",
        intervalMin: 150,
        reminderVoice: "A small snack would keep your energy steady, shield-maiden.",
        overdueVoice: "Even a few bites count as taking care of you.",
        positiveMood: { name: "Snacked", desc: "A small snack topped up your energy.", type: "positive" },
        negativeMood: { name: "Lightheaded", desc: "It’s been a while since you refueled.", type: "negative" }
      },
      bathroom: {
        name: "Bathroom",
        key: "need_bathroom",
        label: "Bathroom break",
        intervalMin: 120,
        reminderVoice: "If you’ve been holding it, this is your sign to take a bathroom break.",
        overdueVoice: "Your body’s needs matter, too—pause and take the break.",
        positiveMood: { name: "Relief", desc: "You actually took a bathroom break.", type: "positive" },
        negativeMood: { name: "Holding it", desc: "You’ve postponed your own basic needs again.", type: "negative" }
      },
      shower: {
        name: "Shower",
        key: "need_shower",
        label: "Shower reset",
        intervalMin: 24 * 60,
        reminderVoice: "A quick hot shower could reset your whole mood, even if it’s short.",
        overdueVoice: "You deserve to feel fresh and reset, not just functional.",
        positiveMood: { name: "Fresh & clean", desc: "A shower buffed your mood and energy.", type: "positive" },
        negativeMood: { name: "Stale", desc: "You’ve been running nonstop. A reset would help.", type: "negative" }
      },
      skincare: {
        name: "Skincare",
        key: "need_skincare",
        label: "Skincare ritual",
        intervalMin: 24 * 60,
        reminderVoice: "Skincare is your small ritual of honor, not vanity.",
        overdueVoice: "You’re allowed to care about your own face in this season.",
        positiveMood: { name: "Skincare buff", desc: "You did your skincare. Goddess unlocked.", type: "positive" },
        negativeMood: { name: "Neglected", desc: "You haven’t been able to touch your skincare lately.", type: "negative" }
      }
    };

    /*************** STORAGE KEYS ***************/
    function doneKey(dateStr, taskId) { return STORAGE_PREFIX + "done_" + dateStr + "_" + taskId; }
    function notesKey(monthKey) { return STORAGE_PREFIX + "notes_" + monthKey; }
    function badDayKey(dateStr) { return STORAGE_PREFIX + "badday_" + dateStr; }
    function dailyJournalKey(dateStr) { return STORAGE_PREFIX + "journal_daily_" + dateStr; }
    function yearJournalKey(year) { return STORAGE_PREFIX + "journal_year_" + year; }
    function statKey(name) { return STORAGE_PREFIX + "stat_" + name; }
    function needLastKey(needKey) { return STORAGE_PREFIX + "need_last_" + needKey; }
    function needMissKey(needKey) { return STORAGE_PREFIX + "need_miss_" + needKey; }

    /*************** UTIL ***************/
    function formatDateLabel(date) {
      return date.toLocaleDateString(undefined, { month: "short", day: "numeric", year: "numeric" });
    }
    function getDayName(date) { return date.toLocaleDateString(undefined, { weekday: "long" }); }
    function getTasksForDate(date) {
      const dayOfMonth = date.getDate();
      const totalTasks = MASTER_TASKS.length;
      const baseIndex = ((dayOfMonth - 1) * 2) % totalTasks;
      const index1 = baseIndex;
      const index2 = (baseIndex + 1) % totalTasks;
      return [MASTER_TASKS[index1], MASTER_TASKS[index2]];
    }
    function getMonthKey(date) {
      const y = date.getFullYear();
      const m = date.getMonth() + 1;
      return y + "-" + String(m).padStart(2, "0");
    }

    /*************** VIKING VOICE SELECTION ***************/
    let vikingVoice = null;

    function selectVikingVoice() {
      if (typeof window === "undefined" || !("speechSynthesis" in window)) return;
      const voices = window.speechSynthesis.getVoices();
      if (!voices || voices.length === 0) return;

      const preferredNames = [
        "Google UK English Female",
        "Google US English Female",
        "Samantha",
        "Victoria",
        "Karen",
        "Serena"
      ];

      let match = voices.find(v => preferredNames.includes(v.name));
      if (!match) {
        match = voices.find(v => /female/i.test(v.name + v.voiceURI));
      }
      vikingVoice = match || voices[0];
    }

    if (typeof window !== "undefined" && "speechSynthesis" in window) {
      const synth = window.speechSynthesis;
      if (typeof synth.addEventListener === "function") {
        synth.addEventListener("voiceschanged", selectVikingVoice);
      } else {
        synth.onvoiceschanged = selectVikingVoice;
      }
      selectVikingVoice();
    }

    function speakText(text) {
      if (typeof window === "undefined" || !("speechSynthesis" in window)) return;
      try {
        const utter = new SpeechSynthesisUtterance(text);
        if (vikingVoice) {
          utter.voice = vikingVoice;
        }
        utter.rate = 0.93;
        utter.pitch = 0.98;
        utter.volume = 1.0;

        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utter);
      } catch (e) {
        // ignore if blocked
      }
    }

    /*************** STATS HELPERS ***************/
    function getStat(name) {
      const raw = localStorage.getItem(statKey(name));
      return raw ? parseInt(raw, 10) || 0 : 0;
    }
    function incStat(name, delta = 1) {
      const current = getStat(name);
      localStorage.setItem(statKey(name), String(current + delta));
    }

    /*************** MOODLET SYSTEM ***************/
    const moodlets = [];

    function addMoodlet({ name, desc, type = "neutral", intensity = 1, durationMinutes = 120 }) {
      const now = Date.now();
      const id = STORAGE_PREFIX + "mood_" + now + "_" + Math.random().toString(36).slice(2);
      const expiresAt = now + durationMinutes * 60 * 1000;
      moodlets.push({ id, name, desc, type, intensity, expiresAt });
      renderMoodlets();
      return id;
    }

    function cleanupMoodlets() {
      const now = Date.now();
      for (let i = moodlets.length - 1; i >= 0; i--) {
        if (moodlets[i].expiresAt && moodlets[i].expiresAt < now) {
          moodlets.splice(i, 1);
        }
      }
      renderMoodlets();
    }

    function computeCurrentMood() {
      if (moodlets.length === 0) return "Neutral • Just existing (which is enough).";
      const active = moodlets.slice().sort((a, b) => b.intensity - a.intensity).slice(0, 3);
      const dominant = active[0];
      if (dominant.type === "positive") {
        return "Gently positive • " + dominant.name;
      } else if (dominant.type === "negative") {
        return "Strained • " + dominant.name;
      } else {
        return "Mixed • " + dominant.name;
      }
    }

    function minutesRemaining(expiresAt) {
      const diffMs = expiresAt - Date.now();
      if (diffMs <= 0) return 0;
      return Math.round(diffMs / 60000);
    }

    function renderMoodlets() {
      const strip = document.getElementById("moodletStrip");
      const label = document.getElementById("currentMoodLabel");
      if (!strip || !label) return;

      cleanupMoodlets();
      strip.innerHTML = "";

      const sorted = moodlets.slice().sort((a, b) => a.expiresAt - b.expiresAt).slice(0, 4);

      sorted.forEach(m => {
        const div = document.createElement("div");
        div.className = "moodlet moodlet-" + (m.type || "neutral");

        const titleRow = document.createElement("div");
        titleRow.className = "moodlet-title-row";

        const nameEl = document.createElement("div");
        nameEl.className = "moodlet-name";
        nameEl.textContent = m.name;

        const pipsEl = document.createElement("div");
        pipsEl.className = "moodlet-pips";
        pipsEl.textContent = "●".repeat(m.intensity).padEnd(3, "○");

        titleRow.appendChild(nameEl);
        titleRow.appendChild(pipsEl);
        div.appendChild(titleRow);

        const descEl = document.createElement("div");
        descEl.className = "moodlet-desc";
        descEl.textContent = m.desc;
        div.appendChild(descEl);

        const timeEl = document.createElement("div");
        timeEl.className = "moodlet-timer";
        const minsLeft = minutesRemaining(m.expiresAt);
        timeEl.textContent = minsLeft > 0 ? `${minsLeft} min left` : "ending soon";
        div.appendChild(timeEl);

        strip.appendChild(div);
      });

      const moodText = computeCurrentMood();
      const span = label.querySelector("span");
      if (span) span.textContent = moodText;
    }

    setInterval(cleanupMoodlets, 60000);

    /*************** DONE / NOTES / JOURNALS / BAD DAY ***************/
    function saveDone(dateStr, taskId, done) {
      const key = doneKey(dateStr, taskId);
      if (done) {
        localStorage.setItem(key, "1");
      } else {
        localStorage.removeItem(key);
      }
    }
    function isDone(dateStr, taskId) {
      return localStorage.getItem(doneKey(dateStr, taskId)) === "1";
    }
    function saveMonthNotes(monthKey, text) {
      localStorage.setItem(notesKey(monthKey), text || "");
    }
    function loadMonthNotes(monthKey) {
      return localStorage.getItem(notesKey(monthKey)) || "";
    }
    function saveBadDay(dateStr, isBad) {
      const key = badDayKey(dateStr);
      if (isBad) localStorage.setItem(key, "1");
      else localStorage.removeItem(key);
    }
    function isBadDay(dateStr) { return localStorage.getItem(badDayKey(dateStr)) === "1"; }

    function updateBadDayUI(dateStr) {
      const btn = document.getElementById("badDayBtn");
      const msg = document.getElementById("badDayMsg");
      if (!btn || !msg) return;

      const active = isBadDay(dateStr);
      if (active) {
        btn.classList.add("active");
        btn.textContent = "Bad day marked • This day still counts as a win";
        msg.textContent = "Even if nothing else happened, keeping three kids fed and loved is enough. You still showed up.";
      } else {
        btn.classList.remove("active");
        btn.textContent = "Bad day? Tap here to still count this day as a win";
        msg.textContent = "";
      }
    }

    function updateDailyJournal(date) {
      const area = document.getElementById("dailyJournal");
      const label = document.getElementById("dailyJournalLabel");
      if (!area || !label) return;
      const dateStr = date.toISOString().slice(0, 10);
      label.textContent = "Today’s journal for " + formatDateLabel(date);
      area.value = localStorage.getItem(dailyJournalKey(dateStr)) || "";
      area.oninput = () => localStorage.setItem(dailyJournalKey(dateStr), area.value);
    }

    function updateYearJournal(referenceDate) {
      const area = document.getElementById("yearJournal");
      const label = document.getElementById("yearJournalLabel");
      if (!area || !label) return;
      const year = referenceDate.getFullYear();
      label.textContent = "Year journal for " + year;
      area.value = localStorage.getItem(yearJournalKey(year)) || "";
      area.oninput = () => localStorage.setItem(yearJournalKey(year), area.value);
    }

    /*************** BACKUP / SIMPLE MODE ***************/
    function backupData() {
      const data = {};
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith(STORAGE_PREFIX)) {
          data[key] = localStorage.getItem(key);
        }
      }
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      const dateStr = new Date().toISOString().slice(0, 10);
      a.href = url;
      a.download = "hearth-home-backup-" + dateStr + ".json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      speakText("Backup created. Your stats and journals are saved in a file.");
    }

    function setSimpleMode(on) {
      const btn = document.getElementById("simpleToggleBtn");
      if (on) {
        document.body.classList.add("simple-mode");
        localStorage.setItem(STORAGE_PREFIX + "simpleMode", "1");
        if (btn) btn.textContent = "Simple View: On";
      } else {
        document.body.classList.remove("simple-mode");
        localStorage.removeItem(STORAGE_PREFIX + "simpleMode");
        if (btn) btn.textContent = "Simple View: Off";
      }
    }

    function initMetaButtons() {
      const simpleBtn = document.getElementById("simpleToggleBtn");
      const saveBtn = document.getElementById("saveBtn");

      // Restore simple mode preference
      const simpleStored = localStorage.getItem(STORAGE_PREFIX + "simpleMode") === "1";
      setSimpleMode(simpleStored);

      if (simpleBtn) {
        simpleBtn.addEventListener("click", () => {
          const on = !document.body.classList.contains("simple-mode");
          setSimpleMode(on);
        });
      }
      if (saveBtn) {
        saveBtn.addEventListener("click", backupData);
      }
    }

    /*************** TODAY & CALENDAR ***************/
    function renderToday(date, isRealToday) {
      const todayDateStr = date.toISOString().slice(0, 10);
      const dayName = getDayName(date);

      const labelDayEl = document.querySelector("#todayLabel .day-name");
      const labelDateEl = document.querySelector("#todayLabel .date-text");
      if (labelDayEl) labelDayEl.textContent = isRealToday ? "TODAY" : dayName.toUpperCase();
      if (labelDateEl) labelDateEl.textContent = "• " + formatDateLabel(date);

      const todayDayName = document.getElementById("todayDayName");
      if (todayDayName) todayDayName.textContent = dayName + " • 2 quests";

      const tasksUl = document.getElementById("todayTasks");
      const todaySummary = document.getElementById("todayDaySummary");
      tasksUl.innerHTML = "";

      const tasks = getTasksForDate(date);
      const areaShort = a => a.split(" ")[0];

      if (todaySummary) {
        todaySummary.textContent = `Today focuses on: ${areaShort(tasks[0].area)} + ${areaShort(tasks[1].area)}`;
      }

      tasks.forEach(task => {
        const li = document.createElement("li");
        li.className = "task";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = isDone(todayDateStr, task.id);
        cb.addEventListener("change", () => {
          saveDone(todayDateStr, task.id, cb.checked);
          if (cb.checked) {
            incStat("quests", 1);
            addMoodlet({ name: "Small house win", desc: "You chipped away at the chaos.", type: "positive", intensity: 1, durationMinutes: 180 });
          }
          renderCalendar(date);
          renderStatsPanel();
        });

        const label = document.createElement("div");
        const area = document.createElement("div");
        area.className = "task-area";
        area.textContent = task.area;

        const main = document.createElement("div");
        main.className = "task-main";
        main.textContent = task.title;

        const desc = document.createElement("div");
        desc.className = "task-desc";
        desc.textContent = task.desc;

        label.appendChild(area);
        label.appendChild(main);
        label.appendChild(desc);

        li.appendChild(cb);
        li.appendChild(label);
        tasksUl.appendChild(li);
      });

      updateBadDayUI(todayDateStr);

      const badBtn = document.getElementById("badDayBtn");
      const badMsg = document.getElementById("badDayMsg");
      if (badBtn && badMsg) {
        badBtn.onclick = () => {
          const currentlyBad = isBadDay(todayDateStr);
          const newValue = !currentlyBad;
          saveBadDay(todayDateStr, newValue);
          updateBadDayUI(todayDateStr);
          renderCalendar(date);
          renderStatsPanel();
          if (newValue) {
            const aff = CHAOS_AFFIRMATIONS[Math.floor(Math.random() * CHAOS_AFFIRMATIONS.length)];
            badMsg.textContent = aff;
            speakText(aff);
            addMoodlet({
              name: "Chaos acknowledged",
              desc: "You named that today was hard instead of pretending it wasn’t.",
              type: "neutral",
              intensity: 2,
              durationMinutes: 240
            });
          } else {
            badMsg.textContent = "";
          }
        };
      }

      const selfBonusBtn = document.getElementById("selfBonusBtn");
      if (selfBonusBtn) {
        selfBonusBtn.onclick = () => {
          incStat("selfcare", 1);
          addMoodlet({
            name: "Self-care buff",
            desc: "You did something kind for yourself. That matters.",
            type: "positive",
            intensity: 3,
            durationMinutes: 300
          });
          speakText("Good. That counts as a real bonus in your day.");
          renderStatsPanel();
        };
      }

      updateDailyJournal(date);
    }

    function renderCalendarHeader() {
      const header = document.getElementById("calendarHeader");
      header.innerHTML = "";
      ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d => {
        const div = document.createElement("div");
        div.className = "cal-header";
        div.textContent = d;
        header.appendChild(div);
      });
    }

    function renderCalendar(referenceDate) {
      const grid = document.getElementById("calendarGrid");
      grid.innerHTML = "";

      const year = referenceDate.getFullYear();
      const month = referenceDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startWeekday = firstDay.getDay();

      const monthLabel = document.getElementById("monthLabel");
      monthLabel.textContent = firstDay.toLocaleDateString(undefined, { month: "long", year: "numeric" });

      let daysWithAnyDone = 0;
      let totalTasksDone = 0;
      let totalTasksThisMonth = daysInMonth * 2;

      const today = new Date();
      const sameMonthAsToday = (today.getMonth() === month && today.getFullYear() === year);

      for (let i = 0; i < startWeekday; i++) {
        const placeholder = document.createElement("div");
        grid.appendChild(placeholder);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        const dateStr = date.toISOString().slice(0, 10);
        const tasks = getTasksForDate(date);
        const done1 = isDone(dateStr, tasks[0].id);
        const done2 = isDone(dateStr, tasks[1].id);
        const bad = isBadDay(dateStr);

        let doneCount = (done1 ? 1 : 0) + (done2 ? 1 : 0);
        if (bad && doneCount < 2) doneCount = 2;

        const cell = document.createElement("div");
        cell.className = "day-cell";
        if (sameMonthAsToday && day === today.getDate()) cell.classList.add("today");

        const num = document.createElement("div");
        num.className = "day-cell-number";
        num.textContent = day;
        cell.appendChild(num);

        const info = document.createElement("div");
        info.className = "day-cell-info";
        const areaShort = a => a.split(" ")[0];
        info.textContent = areaShort(tasks[0].area) + " + " + areaShort(tasks[1].area);
        cell.appendChild(info);

        if (doneCount > 0) {
          const dot = document.createElement("div");
          dot.className = "day-cell-complete";
          cell.appendChild(dot);
          daysWithAnyDone++;
          totalTasksDone += doneCount;
        }

        cell.addEventListener("click", () => {
          const todayNow = new Date();
          const isRealToday =
            todayNow.getFullYear() === date.getFullYear() &&
            todayNow.getMonth() === date.getMonth() &&
            todayNow.getDate() === date.getDate();
          renderToday(date, isRealToday);
        });

        grid.appendChild(cell);
      }

      const statsRow = document.getElementById("statsRow");
      statsRow.innerHTML = "";

      const stat1 = document.createElement("div");
      stat1.className = "stat-pill";
      stat1.innerHTML = `<strong>${daysWithAnyDone}</strong> days with at least 1 quest or bad-day win`;
      statsRow.appendChild(stat1);

      const stat2 = document.createElement("div");
      stat2.className = "stat-pill";
      stat2.innerHTML = `<strong>${totalTasksDone}</strong> / ${totalTasksThisMonth} quests counted this month`;
      statsRow.appendChild(stat2);

      const stat3 = document.createElement("div");
      stat3.className = "stat-pill";
      stat3.textContent = "Goal: two quests a day is enough. Chaos days still count.";
      statsRow.appendChild(stat3);

      const monthKey = getMonthKey(referenceDate);
      const notesArea = document.getElementById("monthNotes");
      notesArea.value = loadMonthNotes(monthKey);
      notesArea.oninput = () => saveMonthNotes(monthKey, notesArea.value);

      updateYearJournal(referenceDate);
    }

    /*************** FEELINGS ***************/
    function initFeelings() {
      const buttons = document.querySelectorAll(".feeling-btn");
      const msgEl = document.getElementById("feelingsMsg");
      if (!buttons || !msgEl) return;

      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          const feeling = btn.getAttribute("data-feeling");
          const options = FEELING_TEXTS[feeling] || [];
          if (options.length === 0) return;
          const text = options[Math.floor(Math.random() * options.length)];
          msgEl.textContent = text;
          speakText(text);
          incStat("feelings", 1);

          const nameMap = {
            stressed: "Stressed moodlet",
            overwhelmed: "Overwhelmed moodlet",
            depressed: "Heavy heart",
            sad: "Sad moodlet",
            angry: "Angry sparks",
            hungry: "Hunger ping",
            good: "Soft good feeling",
            happy: "Happy glow",
            peace: "Peaceful aura",
            ease: "Ease in your chest"
          };

          const positiveSet = ["good", "happy", "peace", "ease"];
          const isPositive = positiveSet.includes(feeling);

          addMoodlet({
            name: nameMap[feeling] || "Feeling check",
            desc: isPositive
              ? "You noticed a good feeling in the middle of everything."
              : "You named how you feel. That counts.",
            type: isPositive ? "positive" : (feeling === "hungry" ? "neutral" : "negative"),
            intensity: isPositive ? 2 : (feeling === "depressed" ? 3 : 2),
            durationMinutes: 180
          });

          renderStatsPanel();
        });
      });
    }

    /*************** NEEDS & TIMERS ***************/
    function getLastNeedTime(need) {
      const raw = localStorage.getItem(needLastKey(need.key));
      return raw ? parseInt(raw, 10) || 0 : 0;
    }
    function setLastNeedTime(need) {
      localStorage.setItem(needLastKey(need.key), String(Date.now()));
    }
    function incNeedMiss(need) {
      const raw = localStorage.getItem(needMissKey(need.key));
      const current = raw ? parseInt(raw, 10) || 0 : 0;
      localStorage.setItem(needMissKey(need.key), String(current + 1));
    }

    function minutesSince(timestamp) {
      if (!timestamp) return Infinity;
      return (Date.now() - timestamp) / 60000;
    }

    function renderNeeds() {
      const container = document.getElementById("needsContainer");
      if (!container) return;
      container.innerHTML = "";

      Object.values(NEEDS_CONFIG).forEach(need => {
        const card = document.createElement("div");
        card.className = "need-card";
        card.id = "needCard_" + need.key;

        const header = document.createElement("div");
        header.className = "need-header";

        const nameEl = document.createElement("div");
        nameEl.className = "need-name";
        nameEl.textContent = need.name;

        const statusEl = document.createElement("div");
        statusEl.className = "need-status";
        statusEl.id = "needStatus_" + need.key;

        header.appendChild(nameEl);
        header.appendChild(statusEl);
        card.appendChild(header);

        const nextEl = document.createElement("div");
        nextEl.className = "need-next";
        nextEl.id = "needNext_" + need.key;
        card.appendChild(nextEl);

        const btnRow = document.createElement("div");
        btnRow.className = "need-btns";

        const okBtn = document.createElement("button");
        okBtn.className = "need-btn ok";
        okBtn.textContent = "Did it";
        okBtn.onclick = () => {
          setLastNeedTime(need);
          incStat("needs_met", 1);
          addMoodlet({ name: need.positiveMood.name, desc: need.positiveMood.desc, type: "positive", intensity: 2, durationMinutes: 180 });
          speakText("Good. That need is met for now.");
          updateNeedDisplay(need);
          renderStatsPanel();
        };

        const skipBtn = document.createElement("button");
        skipBtn.className = "need-btn skip";
        skipBtn.textContent = "Couldn’t now";
        skipBtn.onclick = () => {
          incNeedMiss(need);
          incStat("needs_missed", 1);
          addMoodlet({ name: need.negativeMood.name, desc: need.negativeMood.desc, type: "negative", intensity: 2, durationMinutes: 180 });
          speakText("Understood. It’s still a lot, but you are trying.");
          updateNeedDisplay(need);
          renderStatsPanel();
        };

        btnRow.appendChild(okBtn);
        btnRow.appendChild(skipBtn);
        card.appendChild(btnRow);

        container.appendChild(card);

        updateNeedDisplay(need);
      });
    }

    function updateNeedDisplay(need) {
      const last = getLastNeedTime(need);
      const since = minutesSince(last);
      const statusEl = document.getElementById("needStatus_" + need.key);
      const nextEl = document.getElementById("needNext_" + need.key);
      if (!statusEl || !nextEl) return;

      const interval = need.intervalMin;
      const remaining = interval - since;
      if (!last || since === Infinity) {
        statusEl.textContent = "Not tracked yet";
        statusEl.classList.remove("overdue");
        nextEl.textContent = "Tap “Did it” next time you do this.";
      } else if (remaining > 15) {
        statusEl.textContent = "Satisfied";
        statusEl.classList.remove("overdue");
        nextEl.textContent = `Roughly ${Math.round(remaining)} min until next ideal check-in.`;
      } else if (remaining > 0) {
        statusEl.textContent = "Coming up soon";
        statusEl.classList.remove("overdue");
        nextEl.textContent = `About ${Math.round(remaining)} min until ideal time.`;
      } else {
        statusEl.textContent = "Overdue";
        statusEl.classList.add("overdue");
        nextEl.textContent = `Ideally this happened ${Math.abs(Math.round(remaining))} min ago.`;
      }
    }

    function checkNeedsAndRemind() {
      Object.values(NEEDS_CONFIG).forEach(need => {
        const last = getLastNeedTime(need);
        const since = minutesSince(last);
        const interval = need.intervalMin;
        if (since === Infinity) return;

        const card = document.getElementById("needCard_" + need.key);
        const remaining = interval - since;

        if (remaining <= 0 && remaining > -15) {
          if (card) card.style.boxShadow = "0 0 18px rgba(251,191,36,0.5)";
          speakText(need.reminderVoice);
        } else if (remaining <= -30 && remaining > -90) {
          if (card) card.style.boxShadow = "0 0 18px rgba(248,113,113,0.6)";
          speakText(need.overdueVoice);
          addMoodlet({
            name: need.negativeMood.name,
            desc: need.negativeMood.desc,
            type: "negative",
            intensity: 2,
            durationMinutes: 120
          });
        } else {
          if (card) card.style.boxShadow = "";
        }

        updateNeedDisplay(need);
      });
    }

    setInterval(checkNeedsAndRemind, 60000);

    /*************** STATS VIEW ***************/
    function renderStatsPanel() {
      const totalQuests = getStat("quests");
      const selfCare = getStat("selfcare");
      const feelings = getStat("feelings");

      const winDays = getStat("winDays") || 0;

      document.getElementById("statTotalQuests").textContent = totalQuests;
      document.getElementById("statSelfCare").textContent = selfCare;
      document.getElementById("statFeelings").textContent = feelings;
      document.getElementById("statWinDays").textContent = winDays;

      const levelScore = totalQuests + selfCare * 2;
      const tag = document.getElementById("simLevelTag");
      if (tag) {
        let levelText = "Level 1 • Solopa Seedling of the North";

        if (levelScore > 20 && levelScore <= 60) {
          levelText = "Level 2 • Hearthstead Shield-Maiden";
        } else if (levelScore > 60 && levelScore <= 150) {
          levelText = "Level 3 • Vorpal Hearth-Warden";
        } else if (levelScore > 150) {
          levelText = "Level 4 • Solopa Hearth Goddess of the North";
        }

        tag.textContent = levelText;
      }
    }

    /*************** NAV ***************/
    function initNav() {
      const buttons = document.querySelectorAll(".nav-btn[data-view]");
      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          const viewId = btn.getAttribute("data-view");
          document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
          document.getElementById(viewId).classList.add("active");
          buttons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");

          if (viewId === "statsView") {
            renderStatsPanel();
            renderNeeds();
          }
        });
      });
    }

    /*************** INIT ***************/
    (function init() {
      const today = new Date();
      addMoodlet({
        name: "New day",
        desc: "You opened the app. That’s already a step toward caring for yourself.",
        type: "neutral",
        intensity: 1,
        durationMinutes: 180
      });

      const todayLabel = document.querySelector("#todayLabel .date-text");
      if (todayLabel) {
        todayLabel.textContent = "• " + formatDateLabel(today);
      }

      renderToday(today, true);
      renderCalendarHeader();
      renderCalendar(today);
      initFeelings();
      initNav();
      initMetaButtons();
      renderStatsPanel();
      renderNeeds();
    })();
  </script>
</body>
</html>
